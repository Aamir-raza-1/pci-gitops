# tests/layers/04-app-services/request.yaml
# This is the "kitchen sink" request to test all services together.
tenant_code: "layer4"
environment: "test"

gcp:
  region: "us-central1"
  billing_account_id: "016112-AAF779-C59A78"
  org_id: "547574100405"

organization:
  use_folder: false

network:
  mode: "dedicated"
  dedicated:
    vpc:
      auto_create_subnetworks: false
    subnets:
      - name: "main"
        cidr: "10.102.0.0/24"
        private_ip_google_access: true

infra:
  database:
    enabled: true
    postgres:
      name: "main-db-pg"
      version: "POSTGRES_14"
      tier: "db-g1-small"
  gke:
    enabled: true
    cluster:
      name: "main-cluster"
      initial_node_count: 1
  memorystore:
    enabled: true
    redis:
      name: "session-cache"
      tier: "BASIC"
      memory_size_gb: 1
  pubsub:
    enabled: true
    topics:
      - name: "event-stream"
  eventarc:
    enabled: true
    triggers:
      - name: "audit-log-trigger"
        match:
          type: "google.cloud.audit.log.v1.written"
        destination:
          cloud_run_service_name: "audit-sink"
        service_account_name: "eventarc-trigger-sa"
  dns:
    enabled: true
    managed_zones:
      - name: "example-com"
        dns_name: "testing.example.com."
        description: "Test DNS Zone"
  security:
    enabled: true
    cloud_armor:
      description: "Blocklist suspicious IPs"
      rules:
        - action: "deny(403)"
          priority: 1000
          match:
            versioned_expr: "SRC_IPS_V1"
            config:
              src_ip_ranges: ["192.0.2.0/24"]
